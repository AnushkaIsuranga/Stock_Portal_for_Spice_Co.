<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="Styles/Images/p3.jpg">
        <link rel="stylesheet" href="Styles/theme.css">
        <link rel="stylesheet" href="Styles/bootstrap/bootstrap-5.0.2-dist/css/bootstrap.min.css">
        <style>
            body{
                font-family: inder;
            }

            @font-face {
                font-family: inder;
                src: url('./Styles/fonts/Inder-Regular.ttf');
            }

            .scrollable-table {
                max-height: 400px; /* Adjust as needed */
                overflow-y: auto;
                display: block;
            }

            #footer {
                background-image: url(/Styles/Images/perahara.png);
                height: 200px;
                margin-top: auto;
                text-align: right;
                padding-right: 30px;
                margin-right: 0;
                display: flex;
                align-items: center;
                justify-content: flex-end;
                flex-shrink: 0;
                margin-top: 200px;
            }

            #logo{
                height: 100px;
            }

            #submitButton{
                height: 50px;
                font-size: 20px;
            }


            @media(max-width: 700px){
                #footer{
                    margin-top: 30px;
                }

                #logo{
                    height: 100px;
                }

                #submitButton{
                    height: 30px;
                    font-size: 10px;
                }
            }
        </style>
        <title>Order History</title>
    </head>
    <body>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                //Gathering elements into variables
                const yearSelect = document.getElementById('year');
                const monthSelect = document.getElementById('month');
                const dateSelect = document.getElementById('date');

                // Initialize year dropdown menu
                yearSelect.innerHTML = '<option value="0">All Years</option>';
                for (let year = 2023; year <= 4000; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.text = year;
                    yearSelect.appendChild(option);
                }

                // Initialize month dropdown menu
                monthSelect.innerHTML = '<option value="0">All Months</option>';
                for (let month = 1; month <= 12; month++) {
                    const option = document.createElement('option');
                    option.value = month;
                    option.text = month;
                    monthSelect.appendChild(option);
                }

                // Initialize date dropdown menu
                dateSelect.innerHTML = '<option value="0">All Dates</option>';
                for (let date = 1; date <= 31; date++) {
                    const option = document.createElement('option');
                    option.value = date;
                    option.text = date;
                    dateSelect.appendChild(option);
                }

                // Function to filter data based on selections
                function filterData() {
                    const selectedYear = yearSelect.value;
                    const selectedMonth = monthSelect.value;
                    const selectedDate = dateSelect.value;

                    // Create an XMLHttpRequest object to automatically refresh the table with selected values
                    const xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState === 4 && this.status === 200) {
                            const filteredData = JSON.parse(this.responseText);
                            updateTable(filteredData);
                        }
                    };
                    xhttp.open("POST", "filter_data.php", true);
                    xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xhttp.send("year=" + selectedYear + "&month=" + selectedMonth + "&date=" + selectedDate);
                }

                // Function to update the table with filtered data
                function updateTable(data) {
                    const tableBody = document.getElementById("tableBody");
                    tableBody.innerHTML = "";

                    if (data.length === 0) {
                        tableBody.innerHTML = "<tr><td colspan='4'>No records found based on your filter selection.</td></tr>";
                    } else {
                        for (const row of data) {
                            const tableRow = document.createElement("tr");
                            tableRow.innerHTML = `
                                <td>${row["Order_ID"]}</td>
                                <td>${row["Date"]}</td>
                                <td>${row["Quantity"]}</td>
                                <td>${row["Price_Rs"]}</td>
                            `;
                            tableBody.appendChild(tableRow);
                        }
                    }
                }

                // Call filterData on combobox selection change
                yearSelect.addEventListener('change', filterData);
                monthSelect.addEventListener('change', filterData);
                dateSelect.addEventListener('change', filterData);

                // Initial load of all data
                filterData();
            });
        </script>

        <div class="row-fluid">
            <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
                <div class="container-fluid d-flex justify-content-between align-items-center">
                    <div class="col-4">
                        <a href="main.html"><img src="Styles/Images/p3.png" id="logo" class="rounded navbar-logo" alt="Dilthira pepper logo"></a>
                    </div>
                    <div class="col-4" style="text-align: center; font-size: 4vw;">
                        <h4 style="color: white; font-size: 4vw;">Welcome, <?php echo $_SESSION['user_name']; ?></h4>
                    </div>
                    <div class="col-4" style="text-align: right; margin-right: -30px;">
                        <a href="logout.php">
                            <button type="button" class="btn btn-primary" id="submitButton" style="border-radius: 20px;">Log-Out</button>
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <div class="row-fluid">
            <div class="container-fluid" style="margin: auto; margin-top: 150px;">
                <div class="row-fluid" style="justify-content: center; text-align: center;">
                    <div class="row" style="justify-content: center;">
                        <div class="col">
                            <select id="year" class="form-control"></select>
                        </div>
                        <div class="col">
                            <select id="month" class="form-control"></select>
                        </div>
                        <div class="col">
                            <select id="date" class="form-control"></select>
                        </div><br><br>
                        <div class="col-md">
                            <form action="place_order.php" method="post">
                                <button type="submit" class="form-control" style="background-color: black; color: white;">Place Order</button>
                            </form>
                        </div>
                    </div>
            
                    <div class="scrollable-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Order ID</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">Quantity</th>
                                    <th scope="col">Price</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Table content will be dynamically populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row-fluid">
            <nav class="navbar navbar-expand-lg navbar-custom" id="footer">
            <div class="container-fluid d-flex justify-content-between align-items-center" style="text-align: right; padding-right: 30px;">
                <div class="col" style="font-size: 25px; font-weight: bolder; color: white;">Contact Us<br>
                    <a href="mailto:your-email@example.com" style="color: white; font-size: 15px; text-decoration: none;">
                        dilthira@gmail.com
                        <img src="Styles/Images/icons/mail-outline.svg" alt="email" class="logoo">
                    </a>
                    <br>
                    <a href="tel:+9434567890" style="color: white; font-size: 15px; text-decoration: none;">
                        +94 345 67890
                        <img src="Styles/Images/icons/call-outline.svg" alt="call" class="logoo">
                    </a>
                    <br>
                    <a href="https://www.facebook.com/yourprofile" target="_blank" style="color: white; font-size: 15px; text-decoration: none;">
                        Facebook
                        <img src="Styles/Images/icons/logo-facebook.svg" alt="facebook" class="logoo">
                    </a>
                </div>
            </nav>
        </div>
        <script src="Styles/bootstrap/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>